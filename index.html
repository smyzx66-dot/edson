<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>منصة هدى | مساحتك الهادئة</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://assets.mediadelivery.net/playerjs/player-0.1.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Tajawal', 'sans-serif'] },
                    colors: { 
                        'huda-base': '#fff1f2',     // Rose 50
                        'huda-primary': '#f472b6',  // Pink 400
                        'huda-dark': '#be185d',     // Pink 700
                        'huda-accent': '#e9d5ff',   // Purple 200
                        'huda-text': '#475569'      // Slate 600
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(244, 114, 182, 0.15)',
                        'glow': '0 0 15px rgba(244, 114, 182, 0.3)'
                    }
                }
            }
        }
    </script>

    <style>
        body { 
            background: linear-gradient(135deg, #fff1f2 0%, #fdf4ff 100%);
            font-family: 'Tajawal', sans-serif; 
            color: #475569;
        }
        
        /* تصميم الزجاج الناعم */
        .glass-panel { 
            background: rgba(255, 255, 255, 0.7); 
            backdrop-filter: blur(20px); 
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.8);
        }

        .login-bg-pattern {
            background-color: #fff1f2;
            background-image: radial-gradient(#fbcfe8 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .lecture-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .lecture-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px -5px rgba(244, 114, 182, 0.15); border-color: #fbcfe8; }
        
        .video-wrapper { position: relative; width: 100%; aspect-ratio: 16 / 9; background: #000; border-radius: 20px; overflow: hidden; box-shadow: 0 20px 40px -5px rgba(0,0,0,0.2); }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
        
        /* تخصيص السكرول بار */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #fbcfe8; border-radius: 20px; }
        ::-webkit-scrollbar-thumb:hover { background: #f472b6; }

        .btn-gradient {
            background: linear-gradient(90deg, #f472b6 0%, #db2777 100%);
        }
    </style>
</head>
<body class="h-[100dvh] flex flex-col overflow-hidden">

    <div id="loginScreen" class="fixed inset-0 z-[100] flex items-center justify-center login-bg-pattern transition-all duration-500">
        <div class="w-full max-w-sm p-6 text-center">
            <div class="glass-panel rounded-[2.5rem] p-10 shadow-soft relative overflow-hidden">
                <div class="absolute -top-10 -right-10 w-32 h-32 bg-purple-100 rounded-full blur-2xl opacity-60"></div>
                <div class="absolute -bottom-10 -left-10 w-32 h-32 bg-pink-100 rounded-full blur-2xl opacity-60"></div>

                <div class="relative z-10">
                    <div class="w-24 h-24 mx-auto mb-6 bg-white rounded-full flex items-center justify-center text-huda-primary shadow-glow border border-pink-50">
                        <i class="fa-solid fa-seedling text-4xl"></i>
                    </div>
                    <h1 class="text-3xl font-black text-slate-700 mb-2">منصة هدى</h1>
                    <p class="text-slate-400 text-sm mb-8 font-medium">مساحتك للدراسة بهدوء</p>
                    
                    <div class="space-y-4">
                        <input type="text" id="userInput" placeholder="اسم المستخدم" class="w-full p-4 bg-white rounded-2xl text-slate-600 outline-none border border-pink-100 focus:border-huda-primary focus:ring-4 focus:ring-pink-50 transition-all text-center placeholder-slate-300">
                        <input type="password" id="passInput" placeholder="كلمة المرور" class="w-full p-4 bg-white rounded-2xl text-slate-600 outline-none border border-pink-100 focus:border-huda-primary focus:ring-4 focus:ring-pink-50 transition-all text-center placeholder-slate-300">
                        
                        <button onclick="loginProcess()" id="loginBtn" class="w-full btn-gradient text-white font-bold py-4 rounded-2xl hover:shadow-lg hover:shadow-pink-300/50 active:scale-95 transition-all mt-2">
                            تسجيل الدخول
                        </button>
                    </div>
                    <p id="errorMsg" class="text-rose-500 mt-4 hidden font-bold text-sm bg-rose-50 py-2 rounded-lg"></p>
                </div>
            </div>
        </div>
    </div>

    <div id="appScreen" class="hidden flex flex-col h-full w-full">
        
        <header class="px-6 py-4 bg-white/80 backdrop-blur-md border-b border-pink-100 flex justify-between items-center sticky top-0 z-50">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-pink-100 to-white border border-pink-200 flex items-center justify-center text-huda-primary font-bold shadow-sm">
                    <i class="fa-solid fa-leaf"></i>
                </div>
                <div>
                    <h1 class="text-lg font-black text-slate-700">منصة هدى</h1>
                    <p class="text-[10px] text-slate-400 font-bold">نسخة الطالب</p>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <span id="userBadge" class="hidden md:block text-xs font-bold bg-purple-50 text-purple-400 px-4 py-1.5 rounded-full border border-purple-100">
                    <i class="fa-regular fa-user ml-1"></i> أهلاً بك
                </span>
                <button onclick="logout()" class="w-8 h-8 rounded-full flex items-center justify-center hover:bg-rose-50 text-rose-300 hover:text-rose-500 transition-colors">
                    <i class="fa-solid fa-arrow-right-from-bracket rotate-180"></i>
                </button>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto p-4 md:p-8">
            <div class="max-w-6xl mx-auto">
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                    <div class="bg-white p-6 rounded-[2rem] border border-pink-50 shadow-soft group hover:border-pink-200 transition-colors">
                        <div class="flex justify-between items-start mb-4">
                            <div class="p-3 bg-pink-50 rounded-2xl text-pink-400 group-hover:bg-pink-400 group-hover:text-white transition-colors">
                                <i class="fa-solid fa-chart-pie text-xl"></i>
                            </div>
                            <span class="text-xs font-bold text-slate-300 bg-slate-50 px-2 py-1 rounded-lg">إنجازك</span>
                        </div>
                        <h3 id="statPercent" class="text-4xl font-black text-slate-700 mb-1">0%</h3>
                        <p class="text-xs text-slate-400 font-medium">استمري، التقدم ممتاز!</p>
                    </div>

                    <div class="btn-gradient text-white p-6 rounded-[2rem] shadow-lg shadow-pink-300/40 relative overflow-hidden">
                        <div class="absolute -right-4 -top-4 w-24 h-24 bg-white opacity-10 rounded-full"></div>
                        <div class="relative z-10">
                            <p class="text-xs font-medium text-pink-100 mb-2">المحاضرات المكتملة</p>
                            <h3 id="statCount" class="text-4xl font-black mb-1">0</h3>
                            <p class="text-xs text-pink-100 opacity-90">محاضرة تم إنهاؤها بنجاح</p>
                        </div>
                    </div>

                    <div class="bg-white p-2 rounded-[2rem] border border-pink-50 shadow-soft flex flex-col justify-center">
                        <div class="relative h-full">
                            <input type="text" id="searchInput" placeholder="ابحثي عن درس..." class="w-full h-full bg-slate-50 rounded-[1.5rem] px-12 text-slate-600 outline-none border border-transparent focus:bg-white focus:border-purple-200 transition-all placeholder-slate-400">
                            <i class="fa-solid fa-magnifying-glass absolute top-1/2 -translate-y-1/2 right-5 text-slate-300"></i>
                        </div>
                    </div>
                </div>

                <div id="loading" class="text-center py-20">
                    <div class="inline-block relative">
                        <div class="w-12 h-12 rounded-full border-4 border-pink-100 border-t-pink-400 animate-spin"></div>
                    </div>
                    <p class="font-bold text-slate-400 mt-4">لحظات ونجهزلك الدروس...</p>
                </div>

                <div id="lecturesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-10"></div>
            </div>
        </main>
    </div>

    <div id="videoModal" class="fixed inset-0 z-[200] bg-slate-900/90 backdrop-blur-sm hidden flex flex-col opacity-0 transition-opacity duration-300">
        <div class="p-4 md:p-6 flex justify-between items-center">
            <h2 id="modalTitle" class="text-white font-bold text-lg truncate pr-4 opacity-90"></h2>
            <button onclick="closePlayer()" class="w-10 h-10 rounded-full bg-white/10 text-white hover:bg-rose-500 hover:text-white transition-all flex items-center justify-center">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
        
        <div class="flex-1 flex items-center justify-center p-4">
            <div class="video-wrapper max-w-5xl mx-auto shadow-2xl ring-1 ring-white/10">
                <div id="playerContainer" class="w-full h-full"></div>
            </div>
        </div>
        
        <div class="p-8 text-center">
            <button onclick="markCurrentAsComplete()" class="group bg-white text-slate-900 px-8 py-3 rounded-full font-bold hover:bg-huda-primary hover:text-white transition-all shadow-[0_0_20px_rgba(255,255,255,0.3)]">
                <span class="group-hover:hidden">أتممت المحاضرة <i class="fa-regular fa-circle-check mr-2"></i></span>
                <span class="hidden group-hover:inline-block">عاشت ايدج، استمري! <i class="fa-solid fa-heart mr-2"></i></span>
            </button>
        </div>
    </div>

    <script>
        const THUMB_BASE = "https://vz-41afbedb-987.b-cdn.net";
        
        let allLectures = [];
        let completed = JSON.parse(localStorage.getItem('huda_done')) || [];
        let currentLecId = null;

        // دالة تسجيل الدخول المحلية (بدون سيرفر)
        function loginProcess() {
            const username = document.getElementById('userInput').value.trim();
            const password = document.getElementById('passInput').value.trim();
            const btn = document.getElementById('loginBtn');
            const error = document.getElementById('errorMsg');

            if(!username || !password) return;

            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> جاري التحقق...';
            error.classList.add('hidden');

            // محاكاة تأخير بسيط للواقعية
            setTimeout(() => {
                // التحقق المباشر من الاسم والباسورد
                if (username.toLowerCase() === 'hameed' && password === '12345') {
                    localStorage.setItem('edson_logged', 'true');
                    showApp();
                } else {
                    error.innerText = "اسم المستخدم أو كلمة المرور خطأ!";
                    error.classList.remove('hidden');
                }
                btn.disabled = false;
                btn.innerText = "تسجيل الدخول";
            }, 1000);
        }

        function showApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('appScreen').classList.remove('hidden');
            fetchData();
        }

        function logout() {
            localStorage.removeItem('edson_logged');
            location.reload();
        }

        async function fetchData() {
            try {
                const res = await fetch('data.json');
                const data = await res.json();
                
                allLectures = [];
                data.teachers.forEach(t => {
                    t.classes.forEach(c => {
                        c.lectures.forEach(l => {
                            allLectures.push({ ...l, teacher: t.name, subject: t.subject });
                        });
                    });
                });

                document.getElementById('loading').classList.add('hidden');
                renderLectures(allLectures);
                updateStats();
            } catch (e) {
                document.getElementById('loading').innerHTML = '<span class="text-rose-400">تأكدي من ملف data.json</span>';
            }
        }

        function renderLectures(list) {
            const container = document.getElementById('lecturesList');
            container.innerHTML = '';

            list.forEach(lec => {
                const isDone = completed.includes(lec.id);
                const vidId = lec.url.split('/').pop().split('?')[0];
                const thumb = `${THUMB_BASE}/${vidId}/thumbnail.jpg`;

                const card = document.createElement('div');
                card.className = `lecture-card bg-white rounded-[1.5rem] border border-slate-50 p-3 shadow-sm cursor-pointer ${isDone ? 'opacity-50 grayscale-[50%]' : ''}`;
                card.innerHTML = `
                    <div class="relative rounded-[1.2rem] overflow-hidden mb-3 aspect-video bg-pink-50" onclick="openPlayer('${lec.title}', '${lec.url}', '${lec.id}')">
                        <img src="${thumb}" class="w-full h-full object-cover transition-transform duration-700 hover:scale-110" onerror="this.src='https://placehold.co/600x400/fbcfe8/white?text=No+Image'">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent flex items-end justify-start p-3 opacity-0 hover:opacity-100 transition-opacity">
                            <span class="bg-white/20 backdrop-blur-md text-white px-3 py-1 rounded-full text-xs font-bold border border-white/30">شاهد الآن</span>
                        </div>
                        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-12 h-12 bg-white/90 rounded-full flex items-center justify-center text-rose-400 shadow-lg pointer-events-none">
                            <i class="fa-solid fa-play text-lg ml-1"></i>
                        </div>
                        ${isDone ? '<div class="absolute top-3 right-3 bg-emerald-400/90 backdrop-blur text-white text-[10px] font-bold px-3 py-1 rounded-full shadow-sm"><i class="fa-solid fa-check ml-1"></i> تم الإنجاز</div>' : ''}
                    </div>
                    <div class="px-2 pb-2">
                        <p class="text-[10px] text-pink-400 font-bold mb-1 flex items-center gap-1">
                            <i class="fa-regular fa-circle-play"></i> ${lec.subject}
                        </p>
                        <h4 class="font-bold text-slate-700 line-clamp-1 text-sm mb-2">${lec.title}</h4>
                        <div class="flex justify-between items-center border-t border-slate-50 pt-2">
                            <span class="text-[10px] text-slate-400 font-medium">${lec.teacher}</span>
                            <i class="fa-regular fa-heart text-slate-300 hover:text-rose-400 transition-colors text-xs"></i>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function openPlayer(title, url, id) {
            currentLecId = id;
            document.getElementById('modalTitle').innerText = title;
            const modal = document.getElementById('videoModal');
            modal.classList.remove('hidden');
            setTimeout(() => modal.classList.add('opacity-100'), 10);
            
            const finalUrl = url.includes('?') ? url + "&context=true" : url + "?context=true";
            document.getElementById('playerContainer').innerHTML = `<iframe src="${finalUrl}" allowfullscreen allow="autoplay; encrypted-media"></iframe>`;
        }

        function closePlayer() {
            const modal = document.getElementById('videoModal');
            modal.classList.remove('opacity-100');
            setTimeout(() => {
                modal.classList.add('hidden');
                document.getElementById('playerContainer').innerHTML = '';
            }, 300);
        }

        function markCurrentAsComplete() {
            if(currentLecId && !completed.includes(currentLecId)) {
                completed.push(currentLecId);
                localStorage.setItem('huda_done', JSON.stringify(completed));
                updateStats();
                fetchData();
            }
            closePlayer();
        }

        function updateStats() {
            const total = allLectures.length;
            const count = completed.length;
            const percent = total ? Math.round((count/total)*100) : 0;
            
            document.getElementById('statPercent').innerText = percent + "%";
            document.getElementById('statCount').innerText = count;
        }

        document.getElementById('searchInput').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const filtered = allLectures.filter(l => l.title.toLowerCase().includes(term) || l.teacher.toLowerCase().includes(term));
            renderLectures(filtered);
        });

        if(localStorage.getItem('edson_logged')) showApp();

    </script>
</body>
</html>
